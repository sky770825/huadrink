# 注意事項：付款上傳與營運

## 一、付款憑證上傳（已做的優化）

- **自動壓縮**：選圖超過 100KB 會先壓縮，送出時若仍 > 200KB 會再壓一次，避免大 PNG 原檔上傳卡住。
- **逾時**：上傳約 90 秒、寫入約 20 秒逾時會提示，不會無限轉圈。
- **單檔上限**：建議 8MB 以內，超過會提示。

若使用者仍反映「一直轉圈」：請他確認有看到「已壓縮」或等逾時提示；若常逾時，可檢查網路或 Supabase 專案狀態。

---

## 二、環境與部署

| 項目 | 說明 |
|------|------|
| **本機開發** | 根目錄要有 `.env`，內含 `VITE_SUPABASE_URL`、`VITE_SUPABASE_PUBLISHABLE_KEY`；改動後需**重開** `npm run dev`。 |
| **正式環境（如 Cloudflare Pages）** | 在部署平台設定上述兩個變數，或改為本機 `npm run deploy`（用本機 `.env` 建置再上傳）。 |
| **勿提交 .env** | `.env` 已在 `.gitignore`，不要把真實金鑰推上 Git。 |

---

## 三、安全性（可之後加強）

- **payment-proofs**：目前 anon 可上傳到任意 `{registrationId}/proof.*`。若擔心被猜 ID 覆蓋他人憑證，可改為 Supabase Storage RLS 或 Edge Function 驗證該筆報名存在且為 internal + unpaid 再允許上傳。
- **管理員**：用 service_role 建立管理員後，建議立刻改密碼，並限制 service_role 僅在必要腳本使用。

---

## 四、營運與資料

- **活動／匯款截止日**：若 `constants.ts` 或後台有寫死截止日（如 2/7），活動後記得更新或改為後台設定。
- **成員名單**：`src/lib/members.ts` 為硬編碼；若常異動，可考慮改為後台或 Google Sheets 等動態來源。
- **付款頁與後台不同步**：後台審核付款狀態後，若付款頁仍顯示「待付款」，多半是快取；重新整理或等 invalidate 即可。若你有自訂更新邏輯，記得同時 invalidate `['registrations','payment-eligible']`。

---

## 五、其他

- **Supabase 中斷**：系統完全依賴 Supabase，若服務中斷會無法上傳／查詢；目前已有逾時與錯誤提示，必要時可再加離線提示或重試。
- **上傳頻率**：目前前端有防重複送出（按鈕 disabled）；若擔心濫用，可在 Supabase RPC 或 Edge Function 做簡易頻率限制。

有問題可先對照 `CONNECTION_SETUP.md`、`注意事項.md` 與本檔案。
