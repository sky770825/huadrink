# 付款憑證上傳與讀取 — 實測步驟

用一筆測試單 + 測試圖實測上傳與讀取，並確認「沒有上傳圖片的報名」不會誤顯示他人憑證。

---

## 事前準備

- **測試圖**：任一張圖片（JPG/PNG，建議 < 2MB），例如手機截圖或 `test-proof.jpg`。
- **兩筆測試報名**（可後台手動新增，或使用既有資料）：
  1. **測試單 A**：類型「內部」、付款狀態「尚未付款」、**之後會上傳憑證**。
  2. **測試單 B**：類型「內部」、付款狀態「尚未付款」、**從不上傳憑證**（用來驗證不會誤顯示他人憑證）。

---

## 測試一：有上傳圖片的測試單 — 上傳成功且可讀取

目的：確認上傳流程正常，且後台「查看憑證」能正確顯示該筆的圖片。

1. **取得一筆「內部・尚未付款」的報名**
   - 若沒有：後台 → 報名管理 → 手動新增一筆（類型：內部、付款狀態：尚未付款），記下聯絡人／編號（當作測試單 A）。
2. **開啟付款頁**
   - 瀏覽器打開 **繳費付款** 頁（例如 `/payment`），選擇「內部成員」。
3. **上傳憑證**
   - 「選擇報名者」選 **測試單 A**。
   - 「匯款帳號末五碼」輸入 5 位數字（例如 `12345`）。
   - 「付款憑證」點 **拍照或選取圖片**，選你的測試圖（若有出現「已壓縮」即為正常）。
   - 點 **送出付款憑證**，應出現「上傳成功」。
4. **後台驗證讀取**
   - 登入後台 → 報名管理。
   - 找到 **測試單 A**，點該筆的 **眼睛圖示（查看憑證）**。
   - **預期**：彈出「付款憑證」對話框，顯示剛才上傳的那張圖（同一張、非他人）。
5. **（可選）更換憑證**
   - 在「付款憑證」對話框點 **上傳／更換憑證**，選另一張圖。
   - **預期**：上傳成功後對話框內圖片換成新圖，關閉再打開仍為新圖。

**通過標準**：上傳成功、後台「查看憑證」只顯示該筆自己的圖片，且可成功更換。

---

## 測試二：沒有上傳圖片的測試單 — 不會誤用他人憑證

目的：確認「從未上傳憑證」的報名，在後台點「查看憑證」時不會出現別人的圖片。

1. **使用一筆「內部・尚未付款・從未上傳過憑證」的報名**
   - 若沒有：後台手動新增一筆（測試單 B），**不要**去付款頁上傳憑證。
   - 或：將某筆已付款／待審核改回「尚未付款」並清除憑證後，不再上傳（該筆當作測試單 B）。
2. **後台點「查看憑證」**
   - 報名管理中，找到 **測試單 B**。
   - 若該筆有「匯款末五碼」但沒有憑證圖，仍可能顯示眼睛圖示；點擊 **查看憑證**（或從詳情進入再點）。
3. **預期結果**
   - 應顯示 **「無付款憑證」**（或等同說明），**不應**出現任何他人或測試單 A 的憑證圖片。

**通過標準**：沒有上傳過圖片的該筆，只會看到「無付款憑證」，不會誤顯示他人憑證。

---

## 測試三（建議）：切換報名者會清掉已選圖片

目的：確認不會「選 A 的圖卻送給 B」，避免日後再發生套錯圖。

1. 在付款頁「選擇報名者」選 **測試單 A**。
2. 點「拍照或選取圖片」選一張圖，確認預覽出現。
3. **不要送出**，改為「選擇報名者」選 **測試單 B**（或任另一筆）。
4. **預期**：預覽區的圖片應**自動消失**，必須重新選圖才能送出。
5. 再選回測試單 A：預覽也應為空，需重新選圖。

**通過標準**：只要切換報名者，已選圖片就會被清掉，不會誤套到別筆。

---

## 若實測時遇到狀況

| 狀況 | 建議 |
|------|------|
| 付款頁一直「載入報名名單中」 | 檢查網路、Supabase 專案狀態、`.env` 的 `VITE_SUPABASE_*` 是否正確。 |
| 上傳後後台看不到圖 | 檢查 Supabase Storage 是否有 `payment-proofs` bucket、該筆報名的 `pay_proof_url` 是否有寫入。 |
| 沒有「內部・尚未付款」的報名可選 | 到後台「手動新增報名」建立一筆，類型選內部、付款狀態選尚未付款。 |
| 後台「查看憑證」顯示舊圖 | 重整頁面或關閉對話框再開；若剛做「更換憑證」可再按一次查看。 |

實測完成後，若測試一、二、三都符合預期，即可視為：上傳可成功讀取，且沒有上傳圖片的測試單不會再誤用他人憑證。
