# Google Apps Script 設置指南

## 問題診斷

如果提交後同步失敗，請按照以下步驟檢查和設置：

## 步驟 1: 檢查 Google Apps Script 部署

1. **打開 Google Sheets**
   - 訪問：https://docs.google.com/spreadsheets/d/1cT3VJcDHyqHUEEdRfb7b9zMifBJk6f6upujGYV9dj4U/edit

2. **打開 Apps Script 編輯器**
   - 點擊「擴充功能」>「Apps Script」

3. **檢查代碼**
   - 確認已貼上 `GOOGLE_APPS_SCRIPT_CODE.js` 中的完整代碼
   - 確認有 `doPost` 函數

4. **保存代碼**
   - 點擊「儲存」圖標（Ctrl+S 或 Cmd+S）

## 步驟 2: 部署為網頁應用程式

1. **點擊「部署」>「新增部署作業」**

2. **選擇類型**
   - 點擊「選取類型」旁邊的齒輪圖標
   - 選擇「網頁應用程式」

3. **設置部署選項**
   - **說明**：可以填寫「同步報名資料到 Google Sheets」
   - **執行身分**：選擇「我」
   - **具有存取權的使用者**：選擇「任何人」（重要！）
   - **版本**：選擇「新增」

4. **點擊「部署」**

5. **授權權限**
   - 第一次部署時，會要求授權
   - 點擊「授權存取權限」
   - 選擇您的 Google 帳號
   - 點擊「進階」>「前往 [專案名稱]（不安全）」
   - 點擊「允許」

6. **複製部署 URL**
   - 部署成功後，會顯示「網頁應用程式 URL」
   - **複製這個 URL**

## 步驟 3: 更新環境變數

1. **打開 `.env` 文件**

2. **更新 URL**
   ```env
   VITE_GOOGLE_APPS_SCRIPT_URL="您剛才複製的 URL"
   ```

3. **重新啟動開發伺服器**
   ```bash
   # 停止當前伺服器（Ctrl+C）
   # 然後重新啟動
   npm run dev -- --port 5174
   ```

## 步驟 4: 測試

1. **提交一筆測試報名**

2. **檢查瀏覽器控制台（F12）**
   - 查看是否有錯誤訊息
   - 查看同步相關的日誌

3. **檢查 Google Sheets**
   - 確認資料是否已寫入「工作表1」

## 常見問題

### 問題 1: "找不到網頁" 或 404 錯誤
**解決方案：**
- 確認已正確部署為「網頁應用程式」
- 確認「具有存取權的使用者」設為「任何人」
- 重新部署並獲取新的 URL

### 問題 2: "Script function not found: doPost"
**解決方案：**
- 確認代碼中已包含 `doPost` 函數
- 確認已保存代碼
- 重新部署

### 問題 3: "Moved Temporarily" 或重定向錯誤
**解決方案：**
- 重新部署並獲取新的 URL
- 更新 `.env` 文件中的 URL

### 問題 4: 權限錯誤
**解決方案：**
- 確認已授權 Apps Script 訪問 Google Sheets
- 確認「執行身分」設為「我」
- 確認「具有存取權的使用者」設為「任何人」

## 檢查清單

- [ ] 已將代碼貼到 Apps Script 編輯器
- [ ] 已保存代碼
- [ ] 已部署為「網頁應用程式」
- [ ] 「執行身分」設為「我」
- [ ] 「具有存取權的使用者」設為「任何人」
- [ ] 已複製最新的部署 URL
- [ ] 已更新 `.env` 文件
- [ ] 已重新啟動開發伺服器
- [ ] 已測試提交功能

## 需要幫助？

如果仍然無法同步，請：
1. 打開瀏覽器控制台（F12）
2. 查看「Console」標籤中的錯誤訊息
3. 將錯誤訊息提供給我，我會協助您解決
