# 前端如何連到資料庫

前端是**有**連到 Supabase 資料庫的，流程如下。

## 連線流程

1. **環境變數**（`.env` 在專案根目錄）
   - `VITE_SUPABASE_URL`：Supabase 專案網址  
   - `VITE_SUPABASE_PUBLISHABLE_KEY`：anon key（公開金鑰）

2. **建立 Client**  
   - `src/integrations/supabase/client.ts` 用上面兩個變數建立 `supabase` client。

3. **指定 schema**  
   - `src/lib/supabase-huadrink.ts` 匯出 `huadrink = supabase.schema('huadrink')`，所有華地產春酒的資料都在 **huadrink** schema。

4. **實際查詢**
   - 報名資料：`src/hooks/useRegistrations.ts` 用 `huadrink.from('registrations').select(...)`。
   - 系統設定：`src/hooks/useSystemSettings.ts` 用 `huadrink.from('system_settings')`。
   - 付款憑證上傳：`src/pages/Payment.tsx` 呼叫 `supabase.schema('huadrink').rpc('submit_payment_proof', ...)`。
   - 管理後台：登入後用同一 client，更新/刪除受 RLS 政策管制（需在 `huadrink.admins` 內）。

所以：**前端 → client（.env）→ Supabase API → huadrink schema 的表格**。

## 若畫面上沒有資料或報錯，請檢查

| 項目 | 作法 |
|------|------|
| **.env 有被讀到** | 變數名一定要是 `VITE_SUPABASE_URL`、`VITE_SUPABASE_PUBLISHABLE_KEY`（Vite 只會把 `VITE_` 開頭的變數給前端）。改完 .env 要**重開** `npm run dev`。 |
| **專案根目錄** | `.env` 要放在與 `package.json` 同一層。從專案根目錄執行 `npm run dev`。 |
| **Supabase 有開 huadrink schema** | 在 [Supabase SQL Editor](https://supabase.com/dashboard/project/sqgrnowrcvspxhuudrqc/sql/new) 執行 `supabase/huadrink-expose-schema.sql`（內容包含 `ALTER ROLE authenticator SET pgrst.db_schemas = 'public, huadrink';` 與相關 GRANT）。 |
| **資料表與資料存在** | 已執行 `supabase/huadrink-setup.sql` 建立 `huadrink.registrations`、`huadrink.system_settings`、`huadrink.admins` 等。若從未匯入資料，報名列表會是空的（連線正常但沒資料）。 |

## 開發時確認連線

執行 `npm run dev` 後，打開瀏覽器**開發者工具 → Console**，若看到類似：

```text
[Supabase] 前端資料庫連線： sqgrnowrcvspxhuudrqc | schema: huadrink
```

表示環境變數有被讀到，且前端預期連到該專案的 **huadrink** schema。若看到「缺少環境變數」，代表 .env 沒被載入或變數名錯誤。
