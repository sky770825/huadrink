<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸¬è©¦ç®¡ç†å“¡ç™»å…¥</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #007bff;
      padding-bottom: 10px;
    }
    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #007bff;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
      width: 100%;
    }
    button:hover {
      background: #0056b3;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 14px;
    }
    .success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    .error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    .info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
    }
    .link-btn {
      display: inline-block;
      margin: 10px 5px;
      padding: 10px 20px;
      background: #6c757d;
      color: white;
      text-decoration: none;
      border-radius: 6px;
    }
    .link-btn:hover {
      background: #5a6268;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” æ¸¬è©¦ç®¡ç†å“¡ç™»å…¥</h1>
    
    <div class="info-box">
      <strong>ç®¡ç†å“¡å¸³è™Ÿè³‡è¨Šï¼š</strong><br>
      Email: <code>123@admin.com</code><br>
      å¯†ç¢¼: <code>123456</code>
    </div>

    <div style="margin: 20px 0;">
      <a href="http://localhost:5174/admin/login" target="_blank" class="link-btn">ğŸŒ æ‰“é–‹ç™»å…¥é é¢</a>
      <a href="https://supabase.com/dashboard/project/kwxlxjfcdghpguypadvi/auth/users" target="_blank" class="link-btn">ğŸ”§ ä¿®æ”¹å¯†ç¢¼</a>
    </div>

    <button onclick="testLogin()">æ¸¬è©¦ç™»å…¥</button>
    <button onclick="checkAdminStatus()">æª¢æŸ¥ç®¡ç†å“¡ç‹€æ…‹</button>
    
    <div id="result"></div>
  </div>

  <script>
    const SUPABASE_URL = 'https://kwxlxjfcdghpguypadvi.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3eGx4amZjZGdocGd1eXBhZHZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3ODk5NTMsImV4cCI6MjA4NDM2NTk1M30.0KJIXhxlPOx-5tWQyX12DMNXcWCLc2NmMCyoJY4y024';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    function log(message, type = 'info') {
      const result = document.getElementById('result');
      result.className = type;
      result.textContent = message;
      console.log(message);
    }

    async function testLogin() {
      log('ğŸ” æ­£åœ¨æ¸¬è©¦ç™»å…¥...', 'info');
      
      try {
        const { data, error } = await supabase.auth.signInWithPassword({
          email: '123@admin.com',
          password: '123456',
        });

        if (error) {
          log(`âŒ ç™»å…¥å¤±æ•—: ${error.message}\n\nå¯èƒ½çš„åŸå› ï¼š\n1. å¯†ç¢¼å°šæœªä¿®æ”¹ç‚º 123456\n2. ç”¨æˆ¶ä¸å­˜åœ¨\n3. å¸³è™Ÿæœªç¢ºèª\n\nè«‹å…ˆåœ¨ Supabase Dashboard ä¸­ä¿®æ”¹å¯†ç¢¼`, 'error');
          return;
        }

        if (!data.user) {
          log('âŒ ç™»å…¥å¤±æ•—ï¼šæœªè¿”å›ç”¨æˆ¶è³‡æ–™', 'error');
          return;
        }

        // æª¢æŸ¥æ˜¯å¦ç‚ºç®¡ç†å“¡
        const { data: adminData, error: adminError } = await supabase
          .from('admins')
          .select('id')
          .eq('user_id', data.user.id)
          .maybeSingle();

        let message = 'âœ… ç™»å…¥æˆåŠŸï¼\n\n';
        message += `ğŸ“ ç”¨æˆ¶è³‡è¨Š:\n`;
        message += `   ç”¨æˆ¶ ID: ${data.user.id}\n`;
        message += `   Email: ${data.user.email}\n`;
        message += `   ç®¡ç†å“¡ç‹€æ…‹: ${adminData ? 'âœ… æ˜¯ç®¡ç†å“¡' : 'âŒ ä¸æ˜¯ç®¡ç†å“¡'}\n\n`;

        if (!adminData) {
          message += `âš ï¸ è­¦å‘Šï¼šç”¨æˆ¶å·²ç™»å…¥ï¼Œä½†ä¸æ˜¯ç®¡ç†å“¡ï¼\n`;
          message += `è«‹åœ¨ Supabase SQL Editor ä¸­åŸ·è¡Œï¼š\n`;
          message += `INSERT INTO public.admins (user_id)\n`;
          message += `VALUES ('${data.user.id}')\n`;
          message += `ON CONFLICT (user_id) DO NOTHING;\n`;
        } else {
          message += `ğŸ‰ å¯ä»¥æ­£å¸¸ä½¿ç”¨å¾Œå°ç®¡ç†åŠŸèƒ½ï¼\n`;
          message += `\nğŸ’¡ æç¤ºï¼šç¾åœ¨å¯ä»¥è¨ªå• http://localhost:5174/admin`;
        }

        log(message, adminData ? 'success' : 'error');

        // ç™»å‡º
        await supabase.auth.signOut();
      } catch (error) {
        log(`âŒ éŒ¯èª¤: ${error.message}`, 'error');
      }
    }

    async function checkAdminStatus() {
      log('ğŸ” æ­£åœ¨æª¢æŸ¥ç®¡ç†å“¡ç‹€æ…‹...', 'info');
      
      try {
        // å…ˆæª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å­˜åœ¨
        const { data: users, error: usersError } = await supabase.auth.admin.listUsers();
        
        // ç”±æ–¼æˆ‘å€‘ä½¿ç”¨çš„æ˜¯ anon keyï¼Œç„¡æ³•ç›´æ¥æŸ¥è©¢ auth.users
        // æ”¹ç”¨æŸ¥è©¢ admins è¡¨
        const { data: admins, error: adminsError } = await supabase
          .from('admins')
          .select('*');

        if (adminsError) {
          log(`âŒ æŸ¥è©¢å¤±æ•—: ${adminsError.message}`, 'error');
          return;
        }

        let message = 'ğŸ“Š ç®¡ç†å“¡ç‹€æ…‹æª¢æŸ¥\n\n';
        message += `ç®¡ç†å“¡æ•¸é‡: ${admins?.length || 0}\n\n`;

        if (admins && admins.length > 0) {
          message += 'âœ… æ‰¾åˆ°ç®¡ç†å“¡è¨˜éŒ„:\n';
          admins.forEach((admin, index) => {
            message += `   ${index + 1}. ç®¡ç†å“¡ ID: ${admin.id}\n`;
            message += `      ç”¨æˆ¶ ID: ${admin.user_id}\n`;
            message += `      å‰µå»ºæ™‚é–“: ${new Date(admin.created_at).toLocaleString('zh-TW')}\n\n`;
          });
        } else {
          message += 'âš ï¸ æ²’æœ‰æ‰¾åˆ°ç®¡ç†å“¡è¨˜éŒ„\n';
          message += 'è«‹åŸ·è¡Œ setup_admin_quick.sql ä¸­çš„ SQL ä¾†å‰µå»ºç®¡ç†å“¡\n';
        }

        message += '\nğŸ’¡ æç¤ºï¼š';
        message += '\n1. ç¢ºèªç”¨æˆ¶ 123@admin.com å·²åœ¨ Supabase Dashboard ä¸­å‰µå»º';
        message += '\n2. ç¢ºèªå¯†ç¢¼å·²ä¿®æ”¹ç‚º 123456';
        message += '\n3. ç¢ºèª admins è¡¨ä¸­æœ‰å°æ‡‰è¨˜éŒ„';

        log(message, admins && admins.length > 0 ? 'success' : 'info');
      } catch (error) {
        log(`âŒ éŒ¯èª¤: ${error.message}`, 'error');
      }
    }
  </script>
</body>
</html>
