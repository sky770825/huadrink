# 修復 CORS 錯誤的完整指南

## 問題說明

測試結果顯示：
- ✅ **Supabase 提交成功** - 資料已成功寫入資料庫
- ❌ **Google Sheets 同步失敗** - CORS 錯誤阻止了同步

## 解決步驟

### 步驟 1: 更新 Google Apps Script 代碼

1. 打開 [Google Apps Script 編輯器](https://script.google.com/home/projects)
2. 找到您的專案（應該已經有之前的代碼）
3. **完全替換**現有代碼為 `GOOGLE_APPS_SCRIPT_CODE.js` 文件中的最新版本
4. 點擊「儲存」（Ctrl+S 或 Cmd+S）

### 步驟 2: 重新部署為網頁應用程式

1. 點擊右上角的「**部署**」按鈕
2. 選擇「**管理部署作業**」
3. 如果已有部署：
   - 點擊右側的「**編輯**」（鉛筆圖示）
   - 在「**版本**」下拉選單中選擇「**新增版本**」
   - **重要**：在「**具有存取權的使用者**」中選擇「**任何人**」
   - 點擊「**更新**」
4. 如果沒有部署：
   - 點擊「**新增部署作業**」
   - 點擊「**選取類型**」旁邊的齒輪圖示
   - 選擇「**網頁應用程式**」
   - **執行身分**：選擇「**我**」
   - **具有存取權的使用者**：**必須選擇「任何人」**（這是關鍵！）
   - 點擊「**部署**」
5. 複製新的部署 URL（如果 URL 有變化，請更新 `.env` 文件）

### 步驟 3: 驗證設置

確認以下設置：
- ✅ 執行身分：**我**
- ✅ 具有存取權的使用者：**任何人**（最重要！）
- ✅ 版本：**新增版本**（如果修改了代碼）

### 步驟 4: 測試

1. 重新打開 `test-form.html` 或刷新頁面
2. 點擊「開始測試」按鈕
3. 查看結果

## 常見問題

### Q: 為什麼還是出現 CORS 錯誤？

A: 請確認：
1. **「具有存取權的使用者」必須設為「任何人」**，不能是「只有我自己」
2. 如果修改了代碼，必須選擇「新增版本」並重新部署
3. 等待幾秒鐘讓部署生效

### Q: 如何確認部署設置是否正確？

A: 
1. 點擊「部署」>「管理部署作業」
2. 查看部署詳情
3. 確認「具有存取權的使用者」顯示為「任何人」

### Q: 更新代碼後需要重新部署嗎？

A: 是的！每次修改代碼後：
1. 保存代碼
2. 部署時選擇「新增版本」
3. 確認「具有存取權的使用者」為「任何人」
4. 更新部署

## 測試結果說明

如果一切正常，您應該看到：
```
✅ Supabase 提交成功！
✅ Google Sheets 同步成功！
```

然後可以在 Google Sheets 中看到測試資料已寫入。

## 如果問題仍然存在

如果按照以上步驟操作後仍然出現 CORS 錯誤，請：
1. 截圖部署設置頁面
2. 提供瀏覽器控制台的完整錯誤訊息
3. 確認 Google Apps Script URL 是否正確
